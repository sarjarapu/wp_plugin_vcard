CREATE TABLE {$prefix}minisite_payments (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    minisite_id VARCHAR(32) NOT NULL,
    user_id BIGINT UNSIGNED NOT NULL,
    woocommerce_order_id BIGINT UNSIGNED NULL,
    status ENUM('active','expired','grace_period','reclaimed') NOT NULL DEFAULT 'active',
    amount DECIMAL(10,2) NOT NULL,
    currency CHAR(3) NOT NULL DEFAULT 'USD',
    payment_method VARCHAR(100) NULL,
    payment_reference VARCHAR(255) NULL,
    paid_at DATETIME NOT NULL,
    expires_at DATETIME NOT NULL,
    grace_period_ends_at DATETIME NOT NULL,
    renewed_at DATETIME NULL,
    reclaimed_at DATETIME NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    KEY idx_minisite_status (minisite_id, status),
    KEY idx_user_status (user_id, status),
    KEY idx_expires_at (expires_at),
    KEY idx_grace_period_ends_at (grace_period_ends_at),
    KEY idx_woocommerce_order (woocommerce_order_id)
) ENGINE=InnoDB {$charset};
