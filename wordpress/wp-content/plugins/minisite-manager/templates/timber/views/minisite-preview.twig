{% extends "layouts/minisite-form-layout.twig" %}

{% block content %}
<div class="min-h-screen bg-[var(--surface-0)]">
  <!-- Preview Header -->
  <div class="bg-[var(--surface)] border-b border-[var(--outline-variant)]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-[var(--on-surface)]">{{ previewTitle }}</h1>
          <p class="text-[var(--on-surface-variant)] mt-1">
            Previewing: {{ minisite.name }} - {{ minisite.city }}
          </p>
        </div>
        <div class="flex items-center gap-3">
          <a href="{{ function('home_url','/account/sites/' ~ minisite.id ~ '/edit') }}" 
             class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[var(--surface-1)] text-[var(--on-surface)] ring-1 ring-[var(--outline-variant)] hover:bg-[var(--surface)]">
            <i class="fa-solid fa-edit"></i> Edit
          </a>
          <a href="{{ function('home_url','/account/sites/' ~ minisite.id ~ '/versions') }}" 
             class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[var(--surface-1)] text-[var(--on-surface)] ring-1 ring-[var(--outline-variant)] hover:bg-[var(--surface)]">
            <i class="fa-solid fa-history"></i> Version History
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Preview Frame -->
      <div class="lg:col-span-2">
        <div class="bg-[var(--surface)] rounded-2xl ring-1 ring-[var(--outline-variant)] p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-[var(--on-surface)]">Live Preview</h2>
            <div class="flex items-center gap-2">
              {% if version %}
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-100 text-blue-800 text-sm">
                  <i class="fa-solid fa-tag"></i> Version {{ version.versionNumber }}
                </span>
              {% else %}
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-green-100 text-green-800 text-sm">
                  <i class="fa-solid fa-check"></i> Current Version
                </span>
              {% endif %}
            </div>
          </div>
          
          <div class="border border-[var(--outline-variant)] rounded-lg overflow-hidden bg-white">
            <div class="h-[600px] overflow-auto">
              <!-- Preview Content Placeholder -->
              <div class="p-8 text-center">
                <div class="max-w-md mx-auto">
                  <div class="mb-6">
                    <div class="w-16 h-16 bg-[var(--primary)] rounded-full flex items-center justify-center mx-auto mb-4">
                      <i class="fa-solid fa-building text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">{{ minisite.name }}</h3>
                    <p class="text-gray-600 mb-4">{{ minisite.city }}, {{ minisite.region }}</p>
                  </div>
                  
                  {% if siteJson %}
                    <div class="text-left bg-gray-50 rounded-lg p-4 mb-6">
                      <h4 class="font-semibold text-gray-900 mb-2">Site Configuration</h4>
                      <div class="space-y-2 text-sm text-gray-600">
                        <div><strong>Title:</strong> {{ minisite.title }}</div>
                        <div><strong>Template:</strong> {{ minisite.siteTemplate ?? 'Default' }}</div>
                        <div><strong>Industry:</strong> {{ minisite.industry ?? 'Not specified' }}</div>
                        {% if version %}
                          <div><strong>Version:</strong> {{ version.label ?? 'Version ' ~ version.versionNumber }}</div>
                          {% if version.comment %}
                            <div><strong>Comment:</strong> {{ version.comment }}</div>
                          {% endif %}
                        {% endif %}
                      </div>
                    </div>
                  {% endif %}
                  
                  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center gap-2 text-blue-800 mb-2">
                      <i class="fa-solid fa-info-circle"></i>
                      <span class="font-medium">Preview Mode</span>
                    </div>
                    <p class="text-blue-700 text-sm">
                      This is a preview of your minisite. Changes are not live until published.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="mt-4 flex items-center justify-between text-sm text-[var(--on-surface-variant)]">
            <span>Preview updates when you save changes</span>
            <span>Last updated: {{ "now"|date("M j, Y g:i A") }}</span>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        
        <!-- Version Info -->
        <div class="bg-[var(--surface)] rounded-2xl ring-1 ring-[var(--outline-variant)] p-6">
          <h3 class="text-lg font-semibold text-[var(--on-surface)] mb-4">Version Information</h3>
          <div class="space-y-3">
            {% if version %}
              <div>
                <label class="text-sm font-medium text-[var(--on-surface-variant)]">Version Number</label>
                <p class="text-[var(--on-surface)]">{{ version.versionNumber }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-[var(--on-surface-variant)]">Label</label>
                <p class="text-[var(--on-surface)]">{{ version.label ?? 'No label' }}</p>
              </div>
              <div>
                <label class="text-sm font-medium text-[var(--on-surface-variant)]">Status</label>
                <span class="inline-flex items-center gap-1.5 px-2 py-1 rounded-lg text-sm
                  {% if version.status == 'published' %}bg-green-100 text-green-800
                  {% elseif version.status == 'draft' %}bg-amber-100 text-amber-800
                  {% else %}bg-gray-100 text-gray-800{% endif %}">
                  <i class="fa-solid fa-{% if version.status == 'published' %}check{% elseif version.status == 'draft' %}edit{% else %}clock{% endif %}"></i>
                  {{ version.status|title }}
                </span>
              </div>
              {% if version.comment %}
                <div>
                  <label class="text-sm font-medium text-[var(--on-surface-variant)]">Comment</label>
                  <p class="text-[var(--on-surface)]">{{ version.comment }}</p>
                </div>
              {% endif %}
              <div>
                <label class="text-sm font-medium text-[var(--on-surface-variant)]">Created</label>
                <p class="text-[var(--on-surface)]">{{ version.createdAt|date("M j, Y g:i A") }}</p>
              </div>
            {% else %}
              <div>
                <label class="text-sm font-medium text-[var(--on-surface-variant)]">Version</label>
                <p class="text-[var(--on-surface)]">Current Published Version</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Actions -->
        <div class="bg-[var(--surface)] rounded-2xl ring-1 ring-[var(--outline-variant)] p-6">
          <h3 class="text-lg font-semibold text-[var(--on-surface)] mb-4">Actions</h3>
          <div class="space-y-3">
            <a href="{{ function('home_url','/account/sites/' ~ minisite.id ~ '/edit') }}" 
               class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-[var(--primary)] text-[var(--on-primary)] hover:brightness-95">
              <i class="fa-solid fa-edit"></i> Edit Minisite
            </a>
            <a href="{{ function('home_url','/account/sites/' ~ minisite.id ~ '/versions') }}" 
               class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-[var(--surface-1)] text-[var(--on-surface)] ring-1 ring-[var(--outline-variant)] hover:bg-[var(--surface)]">
              <i class="fa-solid fa-history"></i> Version History
            </a>
            <a href="{{ function('home_url','/account/sites') }}" 
               class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-[var(--surface-1)] text-[var(--on-surface)] ring-1 ring-[var(--outline-variant)] hover:bg-[var(--surface)]">
              <i class="fa-solid fa-list"></i> All Sites
            </a>
          </div>
        </div>

        <!-- Site Details -->
        <div class="bg-[var(--surface)] rounded-2xl ring-1 ring-[var(--outline-variant)] p-6">
          <h3 class="text-lg font-semibold text-[var(--on-surface)] mb-4">Site Details</h3>
          <div class="space-y-3">
            <div>
              <label class="text-sm font-medium text-[var(--on-surface-variant)]">Business Name</label>
              <p class="text-[var(--on-surface)]">{{ minisite.name }}</p>
            </div>
            <div>
              <label class="text-sm font-medium text-[var(--on-surface-variant)]">Location</label>
              <p class="text-[var(--on-surface)]">{{ minisite.city }}, {{ minisite.region }}</p>
            </div>
            <div>
              <label class="text-sm font-medium text-[var(--on-surface-variant)]">SEO Title</label>
              <p class="text-[var(--on-surface)]">{{ minisite.title }}</p>
            </div>
            <div>
              <label class="text-sm font-medium text-[var(--on-surface-variant)]">Template</label>
              <p class="text-[var(--on-surface)]">{{ minisite.siteTemplate ?? 'Default' }}</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock %}
