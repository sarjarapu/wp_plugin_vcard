<!DOCTYPE html>
<html lang="en" class="scroll-smooth" data-theme="blue">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ page_title }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --primary:#2563EB; --on-primary:#fff;
      --secondary:#0EA5E9; --on-secondary:#03283A;
      --background:#F8FAFC; --on-background:#0F172A;
      --surface:#FFFFFF; --on-surface:#0F172A;
      --surface-1:#F1F5F9; --on-surface-variant:#475569;
      --outline:#CBD5E1; --outline-variant:#E2E8F0;
      --focus-ring: color-mix(in srgb, var(--primary) 40%, transparent);
      --surface-0:var(--surface);
    }
    :is(a,button,input,textarea,select):focus-visible {
      outline:none; box-shadow:0 0 0 2px var(--focus-ring), 0 0 0 4px white;
      border-radius:.5rem;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-[var(--background)] text-[var(--on-background)]">
  <main class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <!-- Header -->
      <div class="mb-8">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h1 class="text-3xl font-bold text-[var(--on-surface)]">{{ page_title }}</h1>
            <p class="text-[var(--on-surface-variant)] mt-2">{{ page_subtitle }}</p>
          </div>
          <a href="{{ function('home_url','/account/sites') }}" 
             class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[var(--surface-1)] text-[var(--on-surface)] ring-1 ring-[var(--outline-variant)] hover:bg-[var(--surface)]">
            <i class="fa-solid fa-arrow-left"></i> Back to Sites
          </a>
        </div>
      </div>

      <!-- Error Message -->
      {% if error_msg %}
        <div class="mb-6 p-4 rounded-lg bg-red-50 border border-red-200 text-red-800">
          <i class="fa-solid fa-exclamation-triangle mr-2"></i>
          {{ error_msg }}
        </div>
      {% endif %}

      <!-- Success Message -->
      {% if success_msg %}
        <div class="mb-6 p-4 rounded-lg bg-green-50 border border-green-200 text-green-800">
          <i class="fa-solid fa-check-circle mr-2"></i>
          {{ success_msg }}
        </div>
      {% endif %}

      <!-- Create Minisite Form -->
      <div class="bg-[var(--surface)] rounded-2xl ring-1 ring-[var(--outline-variant)] p-8">
        <h2 class="text-xl font-semibold text-[var(--on-surface)] mb-6">Minisite Details</h2>
        
        <form id="create-minisite-form" method="post" class="space-y-6">
          {{ function('wp_nonce_field', 'minisite_create', 'minisite_nonce') }}
          
          <!-- Business Slug -->
          <div>
            <label for="business_slug" class="block text-sm font-medium text-[var(--on-surface)] mb-2">
              Business Slug <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <input 
                type="text" 
                id="business_slug" 
                name="business_slug" 
                value="{{ form_data.business_slug|default('') }}"
                placeholder="e.g., acme-dental, lotus-textiles"
                required
                pattern="[a-z0-9-]+"
                title="Only lowercase letters, numbers, and hyphens allowed"
                class="w-full rounded-lg bg-[var(--surface-1)] text-[var(--on-surface)] border border-[var(--outline-variant)] px-4 py-3 pr-12 focus:border-[var(--primary)] focus:ring-2 focus:ring-[var(--focus-ring)]"
              />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                <i class="fa-solid fa-building text-[var(--on-surface-variant)]"></i>
              </div>
            </div>
            <p class="mt-1 text-xs text-[var(--on-surface-variant)]">
              This will be part of your minisite URL: <span class="font-mono text-[var(--primary)]">/b/{business-slug}/{location-slug}</span>
            </p>
          </div>

          <!-- Location Slug -->
          <div>
            <label for="location_slug" class="block text-sm font-medium text-[var(--on-surface)] mb-2">
              Location Slug <span class="text-[var(--on-surface-variant)]">(optional)</span>
            </label>
            <div class="relative">
              <input 
                type="text" 
                id="location_slug" 
                name="location_slug" 
                value="{{ form_data.location_slug|default('') }}"
                placeholder="e.g., dallas, mumbai, main-office"
                pattern="[a-z0-9-]+"
                title="Only lowercase letters, numbers, and hyphens allowed"
                class="w-full rounded-lg bg-[var(--surface-1)] text-[var(--on-surface)] border border-[var(--outline-variant)] px-4 py-3 pr-12 focus:border-[var(--primary)] focus:ring-2 focus:ring-[var(--focus-ring)]"
              />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                <i class="fa-solid fa-map-marker-alt text-[var(--on-surface-variant)]"></i>
              </div>
            </div>
            <p class="mt-1 text-xs text-[var(--on-surface-variant)]">
              Leave empty for single-location businesses. If provided, your URL will be: <span class="font-mono text-[var(--primary)]">/b/{business-slug}/{location-slug}</span>
            </p>
          </div>

          <!-- Preview URL -->
          <div id="url-preview" class="hidden p-4 rounded-lg bg-[var(--surface-1)] border border-[var(--outline-variant)]">
            <h3 class="text-sm font-medium text-[var(--on-surface)] mb-2">Preview URL:</h3>
            <p class="font-mono text-[var(--primary)] text-sm" id="preview-url"></p>
          </div>

          <!-- Form Actions -->
          <div class="flex items-center gap-4 pt-6 border-t border-[var(--outline-variant)]">
            <button 
              type="submit" 
              id="create-button"
              class="inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-[var(--primary)] text-[var(--on-primary)] shadow hover:brightness-95 disabled:opacity-50 disabled:cursor-not-allowed font-medium"
            >
              <i class="fa-solid fa-plus" id="create-icon"></i>
              <span id="create-text">Create Minisite</span>
              <div id="create-loading" class="hidden">
                <i class="fa-solid fa-spinner fa-spin"></i>
              </div>
            </button>
            <a href="{{ function('home_url','/account/sites') }}" 
               class="inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-[var(--surface-1)] text-[var(--on-surface)] ring-1 ring-[var(--outline-variant)] hover:bg-[var(--surface)] font-medium">
              Cancel
            </a>
          </div>
        </form>
      </div>

      <!-- Help Section -->
      <div class="mt-8 bg-[var(--surface-1)] rounded-2xl ring-1 ring-[var(--outline-variant)] p-6">
        <h3 class="text-lg font-semibold text-[var(--on-surface)] mb-4">
          <i class="fa-solid fa-lightbulb mr-2"></i>
          How it works
        </h3>
        <div class="space-y-3 text-sm text-[var(--on-surface-variant)]">
          <div class="flex items-start gap-3">
            <span class="flex-shrink-0 w-6 h-6 rounded-full bg-[var(--primary)] text-[var(--on-primary)] text-xs flex items-center justify-center font-medium">1</span>
            <p>Provide a unique business slug (and optional location slug)</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="flex-shrink-0 w-6 h-6 rounded-full bg-[var(--primary)] text-[var(--on-primary)] text-xs flex items-center justify-center font-medium">2</span>
            <p>We'll create an empty minisite profile for you</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="flex-shrink-0 w-6 h-6 rounded-full bg-[var(--primary)] text-[var(--on-primary)] text-xs flex items-center justify-center font-medium">3</span>
            <p>You'll be redirected to the editor to customize your minisite</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // URL Preview functionality
    function updateUrlPreview() {
      const businessSlug = document.getElementById('business_slug').value.trim();
      const locationSlug = document.getElementById('location_slug').value.trim();
      const previewDiv = document.getElementById('url-preview');
      const previewUrl = document.getElementById('preview-url');
      
      if (businessSlug) {
        let url = `/b/${businessSlug}`;
        if (locationSlug) {
          url += `/${locationSlug}`;
        }
        previewUrl.textContent = window.location.origin + url;
        previewDiv.classList.remove('hidden');
      } else {
        previewDiv.classList.add('hidden');
      }
    }

    // Add event listeners
    document.getElementById('business_slug').addEventListener('input', updateUrlPreview);
    document.getElementById('location_slug').addEventListener('input', updateUrlPreview);

    // Form submission handling
    document.getElementById('create-minisite-form').addEventListener('submit', function(e) {
      const button = document.getElementById('create-button');
      const icon = document.getElementById('create-icon');
      const text = document.getElementById('create-text');
      const loading = document.getElementById('create-loading');
      
      // Show loading state
      button.disabled = true;
      icon.classList.add('hidden');
      text.classList.add('hidden');
      loading.classList.remove('hidden');
    });

    // Auto-format slugs (lowercase, replace spaces with hyphens)
    function formatSlug(input) {
      input.addEventListener('input', function() {
        let value = this.value.toLowerCase();
        value = value.replace(/[^a-z0-9-]/g, '-');
        value = value.replace(/-+/g, '-');
        value = value.replace(/^-|-$/g, '');
        this.value = value;
        updateUrlPreview();
      });
    }

    formatSlug(document.getElementById('business_slug'));
    formatSlug(document.getElementById('location_slug'));

    // Initial URL preview
    updateUrlPreview();
  </script>
</body>
</html>
