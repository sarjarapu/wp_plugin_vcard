<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ page_title }}</title>
  <style>
    :root {
      --primary: #2563EB; --on-primary: #fff;
      --background: #F8FAFC; --on-background: #0F172A;
      --surface: #FFFFFF; --on-surface: #0F172A;
      --surface-1: #F1F5F9; --on-surface-variant: #475569;
      --outline-variant: #E2E8F0;
      --error: #DC2626; --success: #059669;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="antialiased bg-[var(--background)] text-[var(--on-background)]">
  <div class="wrap">
    <h1>{{ page_title }}</h1>
    <p class="description">{{ page_description }}</p>
    
    {% if messages %}
      {% for message in messages %}
        <div class="notice notice-{{ message.type }} is-dismissible">
          <p>{{ message.message }}</p>
        </div>
      {% endfor %}
    {% endif %}
    
    <form method="post" action="">
      {{ function('wp_nonce_field', 'minisite_config_save', 'minisite_config_nonce')|raw }}
      <input type="hidden" name="action" value="save">
      
      {% for category, items in configs_grouped %}
        <h2>{{ category|replace({'_': ' '})|title }}</h2>
        <table class="form-table">
          <tbody>
            {% for config in items %}
              <tr>
                <th scope="row">
                  <label for="config_{{ config.key }}">{{ config.display_name }}</label>
                </th>
                <td>
                  {% if config.type == 'boolean' %}
                    <label>
                      <input type="checkbox" 
                             name="config[{{ config.key }}][value]" 
                             value="1" 
                             {{ config.value ? 'checked' : '' }}>
                      Enabled
                    </label>
                  {% elseif config.type == 'json' %}
                    <textarea name="config[{{ config.key }}][value]" 
                              id="config_{{ config.key }}" 
                              class="large-text code" 
                              rows="5">{{ config.value|json_encode(constant('JSON_PRETTY_PRINT')) }}</textarea>
                  {% elseif config.type == 'integer' %}
                    <input type="number" 
                           name="config[{{ config.key }}][value]" 
                           id="config_{{ config.key }}" 
                           value="{{ config.value }}" 
                           class="regular-text">
                  {% else %}
                    <input type="{{ config.is_sensitive ? 'password' : 'text' }}" 
                           name="config[{{ config.key }}][value]" 
                           id="config_{{ config.key }}" 
                           value="{{ config.display_value }}" 
                           class="regular-text">
                  {% endif %}
                  
                  {% if config.description %}
                    <p class="description">{{ config.description }}</p>
                  {% endif %}
                  
                  {% if config.is_sensitive %}
                    <p class="description">
                      <i class="fa-solid fa-lock" style="color: var(--error);"></i>
                      Sensitive data - encrypted storage
                    </p>
                  {% endif %}
                  
                  <p class="description">
                    <small>Type: <code>{{ config.type }}</code></small>
                  </p>
                  
                  <input type="hidden" name="config[{{ config.key }}][type]" value="{{ config.type }}">
                  {% if config.description %}
                    <input type="hidden" name="config[{{ config.key }}][description]" value="{{ config.description }}">
                  {% endif %}
                </td>
                <td>
                  <button type="submit" 
                          name="action" 
                          value="delete"
                          formaction="{{ admin_url('admin-post.php?action=minisite_config_delete&key=' ~ config.key ~ '&nonce=' ~ delete_nonce) }}"
                          class="button button-small"
                          onclick="return confirm('Are you sure you want to delete this configuration?');">
                    Delete
                  </button>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endfor %}
      
      {{ function('submit_button', 'Save Changes')|raw }}
    </form>
    
    <hr>
    
    <h2>Add New Configuration</h2>
    <form method="post" action="">
      {{ function('wp_nonce_field', 'minisite_config_save', 'minisite_config_nonce')|raw }}
      <input type="hidden" name="action" value="save">
      
      <table class="form-table">
        <tr>
          <th><label for="new_config_key">Configuration Key</label></th>
          <td>
            <input type="text" 
                   id="new_config_key" 
                   name="new_config_key" 
                   class="regular-text" 
                   placeholder="e.g., whatsapp_access_token"
                   pattern="[a-z][a-z0-9_]*"
                   required>
            <p class="description">Use lowercase with underscores only (e.g., whatsapp_access_token)</p>
          </td>
        </tr>
        <tr>
          <th><label for="new_config_type">Type</label></th>
          <td>
            <select id="new_config_type" name="new_config_type" required>
              <option value="string">String</option>
              <option value="integer">Integer</option>
              <option value="boolean">Boolean</option>
              <option value="json">JSON</option>
              <option value="encrypted">Encrypted (for API keys, tokens)</option>
              <option value="secret">Secret (one-way hash)</option>
            </select>
          </td>
        </tr>
        <tr>
          <th><label for="new_config_value">Value</label></th>
          <td>
            <textarea id="new_config_value" 
                      name="new_config_value" 
                      class="large-text" 
                      rows="3"
                      placeholder="Enter configuration value"></textarea>
          </td>
        </tr>
        <tr>
          <th><label for="new_config_description">Description</label></th>
          <td>
            <textarea id="new_config_description" 
                      name="new_config_description" 
                      class="large-text" 
                      rows="2"
                      placeholder="Optional description"></textarea>
          </td>
        </tr>
      </table>
      
      {{ function('submit_button', 'Add Configuration')|raw }}
    </form>
  </div>
</body>
</html>

